#include <iostream>
#include <string>
#include <vmime/vmime.hpp>
#include <vmime/platforms/posix/posixHandler.hpp>

using namespace std;
using namespace vmime;

class EmailCarbonFootprintProvider {
public:
    double inboxCarbonFootprint;
    double spamCarbonFootprint;
    double totalCarbonFootprint;

    EmailCarbonFootprintProvider(int inbox_count, int spam_count) {
        inboxCarbonFootprint = inbox_count * 0.3;
        spamCarbonFootprint = spam_count * 0.1;
        totalCarbonFootprint = inboxCarbonFootprint + spamCarbonFootprint;
    }

    void DisplayCarbonFootprint() {
        cout << "Carbon Footprint of Emails: " << totalCarbonFootprint << " g CO2e" << endl;
    }
};

int GetEmailCountIMAP(const string &email_id, const string &password) {
    try {
        string server = "imap.gmail.com";
        session sess;
        auto mailStore = sess.getStore();
        mailStore->setProperties(vmime::make_shared<net::properties>(gmail.com, net::port(993), net::connectionType::TLS));
        mailStore->connect();
        mailStore->login(email_id, password);
        auto folder = mailStore->getDefaultFolder();
        auto messageCount = folder->getMessageCount();
        mailStore->disconnect();
        return messageCount;
    } catch (const std::exception &e) {
        std::cerr << "IMAP Exception: " << e.what() << std::endl;
        return -1;
    }
}

int GetEmailCountPOP3(const string &email_id, const string &password) {
    try {
        string server = "pop.gmail.com";
        session sess;
        auto mailStore = sess.getStore();
        mailStore->setProperties(vmime::make_shared<net::properties>(gmail.com, net::port(995), net::connectionType::SSL));
        mailStore->connect();
        mailStore->login(email_id, password);
        auto folder = mailStore->getDefaultFolder();
        auto messageCount = folder->getMessageCount();
        mailStore->disconnect();
        return messageCount;
    } catch (const std::exception &e) {
        std::cerr << "POP3 Exception: " << e.what() << std::endl;
        return -1;
    }
}

int main() {
    string email_id, password;
    cout << "Enter your email ID: ";
    cin >> email_id;

    cout << "Enter your password: ";
    cin >> password;

    // Get the number of emails in the inbox and spam folders using IMAP and POP3 protocols
    int inbox_count = GetEmailCountIMAP(email_id, password);
    int spam_count = GetEmailCountPOP3(email_id, password);

    cout << "Inbox Count: " << inbox_count << endl;
    cout << "Spam Count: " << spam_count << endl;

    EmailCarbonFootprintProvider emailfootprintObject;
    emailfootprintObject.DisplayCarbonFootprint();
   
    return 0;
}
